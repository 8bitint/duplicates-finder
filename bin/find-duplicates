#!/usr/bin/env ruby
require_relative '../lib/arguments_parser'
require_relative '../lib/content_duplication_resolver_strategy'
require_relative '../lib/digest_duplication_resolver_strategy'
require_relative '../lib/duplicate_file_candidates'
require_relative '../lib/duplicates_finder'
require_relative '../lib/duplicates_printer'
require_relative '../lib/duplicates_resolver'
require_relative '../lib/file_iterator'

arguments_parser = ArgumentsParser.new(ARGV)
unless arguments_parser.error.nil?
  puts arguments_parser.error
  exit 1
end

file_iterator = FileIterator.new
duplicate_file_candidates = DuplicateFileCandidates.new
content_duplication_resolver_strategy = ContentDuplicationResolverStrategy.new
digest_duplication_resolver_strategy = DigestDuplicationResolverStrategy.new
duplicates_resolver = DuplicatesResolver.new(content_duplication_resolver_strategy, digest_duplication_resolver_strategy)
duplicates_printer = DuplicatesPrinter.new
duplicate_finder = DuplicatesFinder.new(arguments_parser.options, file_iterator, duplicate_file_candidates, duplicates_resolver)

duplicate_finder.find.each do |group|
  duplicates_printer.print(group)
end
